name: Monitor Orders

on:
  schedule:
    - cron: '*/15 * * * *'  # Cada 15 minutos
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: order-monitor
  cancel-in-progress: true

jobs:
  monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install dependencies
        run: pip install requests pandas numpy

      - name: ğŸ” Check open orders
        run: |
          if [ ! -f "open_orders.json" ]; then
            echo "No open orders file"
            exit 0
          fi
          
          if [ ! -s "open_orders.json" ]; then
            echo "Open orders file is empty"
            exit 0
          fi
          
          echo "Monitoring orders..."
          python -c "
          from kraken_trader import monitor_orders
try:
    monitor_orders()
    print('âœ… Monitoring complete')
except Exception as e:
      print(f'âš ï¸ Error: {e}')
" || echo "âš ï¸ Monitoring script not ready yet"

      - name: ğŸ’¾ Update if needed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add kraken_trades.csv open_orders.json || true
          
          if git diff --staged --quiet; then
            echo "No order updates"
            exit 0
          fi
          
          git commit -m "ğŸ” Monitor update $(date +'%H:%M')" || true
          git push origin main || true
